#!/bin/bash

echo "Updating system..."
sudo apt update -y
sudo apt upgrade -y

############################
# Install LDAP
############################
echo "Installing LDAP..."
sudo DEBIAN_FRONTEND=noninteractive apt install -y slapd ldap-utils
sudo systemctl enable slapd
sudo systemctl start slapd

############################
# Install Elasticsearch 7.x
############################
echo "Installing Elasticsearch..."
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
sudo apt install -y apt-transport-https
echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-7.x.list

sudo apt update -y
sudo apt install -y elasticsearch logstash kibana

sudo systemctl enable elasticsearch kibana
sudo systemctl start elasticsearch kibana

############################
# Install Zabbix
############################
echo "Installing Zabbix..."
wget https://repo.zabbix.com/zabbix/6.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.0-4+ubuntu22.04_all.deb
sudo dpkg -i zabbix-release_6.0-4+ubuntu22.04_all.deb
sudo apt update -y

sudo apt install -y zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-agent

sudo systemctl enable zabbix-server zabbix-agent apache2
sudo systemctl start zabbix-server zabbix-agent apache2

echo "Login Node configured with LDAP + ELK + Zabbix"
